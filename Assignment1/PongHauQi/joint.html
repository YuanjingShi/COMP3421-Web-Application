<html>
    <head>
        <script type = "text/javascript">
            var b = "blank";
            
            //Poem initialization
            var poem = [
                [
                    [b,"16","t01_11","06","01","t01_11"],
                    [b,"17","12","07","02","t02_14"],
                    
                    [b,"18","13","08","03",b],
                    [b,"19","t02_14","09","04",b],
                    [b,"20","15","10","05",b]
                ],
                [
                   [b,"16","11","06","01","t01"],
                    [b,"17","12","07","02","t02"],
                    [b,"18","13","08","03",b],
                    [b,"19","14","09","04",b],
                    [b,"20","15","10","05",b]
                ],
                [
                    [b,"16","11","06","01","t01"],
                    [b,"17","12","07","02","t02"],
                    [b,"18","13","08","03","t03"],
                    [b,"19","14","09","04","t04"],
                    [b,"20","15","10","05",b]
                ]
            ];
            
            //Row & Column numbers initialization
            
            var rowNum = 5;
            var colNum = 6;
        
            //Cell position and Content
            
            var picturePosition = new Array(colNum*rowNum);
            
            var pictureContent = new Array(colNum*rowNum);
            
            var level = 0;
            var result;
            
            result = new Array(rowNum);
            
            for(var j = 0; j < rowNum, j++){
                result[j] = new Array(colNum);
            }
            
            xPos = new Array(colNum + 1);
            yPos = new Array(rowNumber + 1);
            
            var inHand = "blank";
            
            var dragObject = null;
            var mouseOffset = null;
            var startDrag = 0;
            
            time = 200;
        
        //function play()
        function play(){
            
            level = 1 + Math.floor((Math.random()*3));
            showPoem(level);
            registerEvent();
            getCellPositionX();
            getCellPositionY();
            startTimer();
            
        }
        
        //function getCellPosition()
        function getCellPositionX(){
            for(var i = 0; i < colNum; i++){
                var n = i;
                xPos[i] = document.body.offsetLeft + document.body.clientLeft + document.getElementByld("table").offsetLeft + document.getElementById("table" ).clientLeft + document.getElementById("row0").offsetLeft+document.getElementById("row0" ).clientLeft + document.getElementById("cell"+n).offsetLeft + document.getElementById("cell"+n).clientLeft + 1;
            }
            xPos[colNum] = 2*xPos[colNum - 1] - xPos[colNum -2];
        }
            
        //function getCellPositionY()
        function getCellPositionY(){
            for(var i = 0; i < rowNum; i++){
                var n = i*colNum;
                yPos[i] = document.body.offsetTop + document.body.clientTop + document.getElementByld("table").offsetTop + document.getElementById("table" ).clientTop + document.getElementById("row" + i).offsetTop+document.getElementById("row" + i ).clientTop + 1;
                ////no need to document.getElementById("cell"+n). offsetTop;
            }
            yPos[rowNum] = 2*yPos[rowNum - 1] - yPos[rowNum -2];
        }
            
        //function showPoem()
        function showPoem(i){
            
            var newPoem = randomPoem(i);
            result = newPoem;
            
            for(var j = 0; j < rowNum; j++){
                for(var k = 0;k<colNum;k++){
                    n = j*colNum + k;
                    var target = document.getElementById("cell" + n);
                    if(newPoem[j][k] != b){
                        target.innerHTML = getImage(i,n,newPoem[j][k]);
                        picturePosition[n] = n;
                        pictureContent[n] = newPoem[j][k];
                        }
                    }
                }
        }
            
        //function randomPoem()
        function randomPoem(i){
                var temp = new Array(rowNum);
                
                for (var j = 0; j < rowNum; j++){
                    temp[j] = new Array(colNum);
                }
                
                for (ar j = 0; j < rowNum; j++){
                    for(var k = 0; k < colNum; k++){
                        temp[j][k] = poem[i-1][j][k];
                    }
                }
                
                for(var j = 0; j < rowNum; j++){
                    for(var k = 0; k < colNum; k++){
                        var m = Math.floor(Math.random()*rowNum);
                        var n = Math.floor(Math.random()*colNum);
                        var tmp = temp[j][k];
                        temp[j][k] = temp[m][n];
                        temp[m][n] = tmp;    
                    }
                }
                
                return temp;
        }
            
        //function getImage()
        function getImage(i,j,ch){
            var extension = "";
            if(i == 1 || i == 3){
                extension = "png"
            }else{
                extension = "jpg"
            }
            
            var img =  "<img id = \"" + j + "\" src = \"poem" + i + "/" + ch + "." + extension + "\"/>";
            
            return img;
        }
        
        //function check()
        function check(){
            for(var j=0;j<rowNum;j++){
                for(var k=0;k<colNum;k++){
                    if(result[j][k]!=poem[level‐1][j][k]){
                        alert("You got wrong answer");
                        return false;}
                }
            }
            alert("right!");
            return true;
        }
        
        //function check()
        function check(){
            for(var j=0;j<rowNum;j++)
                for(var k=0;k<colNum;k++){
                    if(result[j][k]!=poem[level‐1][j][k]){
                        alert("You got wrong answer");
                        return false;}
                }
            alert("right!");
            return true;
        }
            
        //function clearAnswer()
        function clearAnswer(){
            for(var i = 0;i<colNum*rowNum;i++)
                result[i] = "";
        }
            
        //function getMouseOffset()
        function getMouseOffset(){
            ev = ev || window.event;
            var docPos = getPosition(target);
            var mousePos = mouseCoords(ev);
            return {x:mousePos.x ‐ docPos.x, y:mousePos.y ‐ docPos.y};
        }
            
        //function getPosition()
        function getPosition(e){
            var left = 0;
            var top = 0;
            
            while (e.offsetParent){
                left += e.offsetLeft;
                top += e.offsetTop;
                e = e.offsetParent;
            }
            left += e.offsetLeft;
            top += e.offsetTop;
            return {x:left, y:top};
        }
        //function mouseMove()
        function mouseMove(ev){
            ev = ev || window.event;
            var mousePos = mouseCoords(ev);
            
            if(dragObject){
                dragObject.style.position = 'absolute';
                dragObject.style.top = mousePos.y ‐ mouseOffset.y;
                dragObject.style.left = mousePos.x ‐ mouseOffset.x;
                
                desRow = -1;
                desCol = -1;
                //alert(mousePos.x+" "+mousePos.y);
                
                for(var i=0;i<colNum;i++){
                    if(mousePos.x > xPos[i] && mousePos.x < xPos[i+1]){
                        desCol = i;
                        break;
                    }
                    
                }
                
                for(var i=0;i<rowNum;i++){
                    if(mousePos.y > yPos[i] && mousePos.y < yPos[i+1]){
                        desRow = i;
                        breal;
                    }
                }
                
                //alert(desRow + " " + desCol);
                return false;
                }
        }
                
        //function mouseUp()
        function mouseUp(ev){
            if(desRow!=‐1&&desCol!=‐1&&result[desRow][desCol]==b&&inhand!=b){
                dragObject.style.position = 'absolute';
                dragObject.style.top = yPos[desRow];
                dragObject.style.left = xPos[desCol];
                //alert("inhand is "+inhand);
                result[desRow][desCol] = inhand;
                result[(originalIndex ‐originalIndex%colNum)/colNum][originalIndex%colNum] = b;
                picturePosition[parseInt(this.id)] = desRow*colNum + desCol;
                inhand = b;
                //alert(result[desRow][desCol]);
            }else{
                //alert("has");
                //alert("desRow is" + desRow + "desCol" + desCol + "result at"+result[desRow][desCol]+" inhand "+inhand);
                dragObject.style.position = 'absolute';
                dragObject.style.top = originalY;
                dragObject.style.left = originalX;
            }
        }
        //function makeDraggable()
        function makeDraggable(item){
            
        if(!item)
            return;
            
            item.onmousedown = function(ev){
                if(dragObject == null){
                    //alert(this.id);
                    //alert(this.id.substring(3));
                    var pictureId = parseInt(this.id);
                    //alert("lala" + pictureId);
                    originalIndex = picturePosition[pictureId];
                    //alert("originalIndex" + originalIndex);
                    originalX = offsetLeft+document.body.clientLeft + document.getElementById("   ").offsetLeft+document.getElementById("table" ).clientLeft + document.getElementById("row0").offsetLeft+document.getElementById("row0" ).clientLeft + document.getElementById("cell"+originalIndex).offsetLeft + document.getElementById("cell"+originalIndex).clientLeft + 1;
                    
                    originalY = document.body.offsetTop+document.body.clientTop + document.getElementById("table").offsetTop+document.getElementById("table").clientTop + document.getElementById("cell"+originalIndex).offsetTop + document.getElementById("cell"+originalIndex).clientTop + 1; + 1;
                    
                        //alert(" x is " + originalX + " " + originalY);
                        //alert(originalIndex);
                        inhand = pictureContent[pictureId];
                        dragObject = this;
                }
                mouseOffset = getMouseOffset(this, ev);
                return false;
            }
            
        }
        //mouseCoords()
        function mouseCoords(ev){
            if(ev.pageX || ev.pageY){
                return {x:ev.pageX, y:ev.pageY};
            }
            
            retun{
                x:ev.clientX + document.body.scrollLeft ‐ document.body.clientLeft,
                y:ev.clientY + document.body.scrollTop ‐ document.body.clientTop
            };
        }
        //function registerEvent()
        function registerEvent(){
            for(var i = 0;i<rowNum*colNum;i++){
                try{
                   document.getElementById(i).onmouseup = mouseUp;
                    document.getElementById(i).onmousemove = mouseMove;
                    makeDraggable(document.getElementById(i));
                }
                catch(e){
                    
                }
            }
        }
        //function startTimer()
        function startTimer(){
            timerId = window.setInterval( "updateTime()", 1000 );
        }
        //function updateTime(){
        function updateTime(){
            --time;
            document.getElementById("timer").innerHTML = time;
            
            if(time==0){
                catchCoin = new Number(originAmount ‐ amount);
                alert("Game Over ! You catched " + catchCoin.toFixed(1) + " dollars");
                window.clearInterval(timerId);
                document.getElementById("timer").innerHTML = 0;
                
                window.close();
            }
        }
        
        </script>
    
    
    </head>
    <body onload = "play()">
    <script type = "text/javascript">
        document.writeln("<p> Time Left: <label id=\"timer\"/></p>");
        document.writeln("<table id = \"table\" border = \"2\">");
        
        for(var i = 0;i<rowNum*colNum;i++){
            var rowIndex = (i ‐ i%colNum)/colNum;
            if(i%colNum==0){
                document.write("<tr id = \"row" + rowIndex + "\" >");
            }
            
            document.writeln("<td width = \"50\" height = \"50\" id = \"cell" + i + "\"></td>");
            
            if(i%colNum == colNum‐1){
                document.write("</tr>");
            }
            document.write("</table>");
            
            function dialog(){
                alert("you chose to exit");
                window.close();
            }
        </script>
        
    <input type = "button" value = "Finish" onclick = "check()"/>
    <input type = "button" value = "Reset" onclick = "dialog()"/><input>
    
    </body>






</html>